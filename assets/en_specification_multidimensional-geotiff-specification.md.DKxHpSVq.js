import{_ as s,c as n,a2 as a,j as e,a as t,o}from"./chunks/framework.9hYZJcoh.js";const r="/mrio/assets/content-mcog.DSIngxES.svg",l="/mrio/assets/write_mode.BZq6Ydw1.gif",d="/mrio/assets/mode.BUXJ3ZN4.svg",h="/mrio/assets/qgis.CjZZZKPn.png",p="/mrio/assets/read_mode.CmDu49cQ.gif",E=JSON.parse('{"title":"The Multidimensional COG","description":"","frontmatter":{},"headers":[],"relativePath":"en/specification/multidimensional-geotiff-specification.md","filePath":"en/specification/multidimensional-geotiff-specification.md"}'),c={name:"en/specification/multidimensional-geotiff-specification.md"};function m(u,i,g,f,y,k){return o(),n("div",null,i[0]||(i[0]=[a('<h1 id="the-multidimensional-cog" tabindex="-1">The Multidimensional COG <a class="header-anchor" href="#the-multidimensional-cog" aria-label="Permalink to &quot;The Multidimensional COG&quot;">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>Unlike GeoTIFF, which enforces strict metadata standards, traditional multidimensional formats typically rely on the flexible <a href="https://cfconventions.org/" target="_blank" rel="noreferrer">CF metadata conventions</a>. While this flexibility offers broad applicability, it also leads to inconsistent implementations across software platforms and public datasets. Probably, the major concern is the lack of standardization for <a href="https://github.com/zarr-developers/geozarr-spec/issues/53" target="_blank" rel="noreferrer">CRS information</a>; although CF conventions allow the inclusion of CRS details, they do not enforce a uniform format. Similar issues arise with other critical metadata components, such as the definition of temporal attributes and data overviews. Consequently, users often need to determine the appropriate structure manually, which can result in inconsistent dataset interpretations and additional preprocessing steps that further complicate geospatial workflows.</p><p>To address these challenges, the Multidimensional COG (mCOG) specification extends the traditional GeoTIFF format to support N-dimensional arrays. Our core principle is that everything should be explicit by default. The mCOG format maintains the simplicity and compatibility of COG/GeoTIFF, offers fast and partial data access, and ensures compatibility with any GIS software or library that supports the GDALGeoTIFF format.</p><p>The following decisions have been considered in the development of mCOG:</p><ul><li>A mCOG must be compliant with the <a href="https://docs.ogc.org/is/21-026/21-026.html" target="_blank" rel="noreferrer">COG specification</a>.</li><li>A mCOG must be compliant with the <a href="https://github.com/stac-extensions/datacube" target="_blank" rel="noreferrer">STAC datacube specification</a>.</li></ul><figure style="display:flex;flex-direction:column;align-items:center;"><img src="'+r+`" alt="Band GIF" style="width:60%;"></figure><h2 id="file-format-details" tabindex="-1">File format details <a class="header-anchor" href="#file-format-details" aria-label="Permalink to &quot;File format details&quot;">​</a></h2><p>This is the version <code>0.1.0</code> of the mCOG specification. From a high-level perspective, the main difference between a <a href="https://docs.ogc.org/is/19-008r4/19-008r4.html" target="_blank" rel="noreferrer">traditional COG</a> and an mCOG is the addition of a TAG named <strong><code>MD_METADATA</code></strong> that contains the metadata of the multidimensional array. With this metadata, client libraries can reshape the data from a 3D array (band, x, y) structure to an N-dimensional array.</p><p>The <code>MD_METADATA</code> tag is embedded within the <code>TIFFTAG_GDAL_METADATA</code> ASCII tag (code 42112), as recommended by the <a href="https://gdal.org/en/stable/drivers/raster/gtiff.html#metadata" target="_blank" rel="noreferrer">GDAL documentation</a> for handling non-standard metadata. This approach ensures compatibility with the GeoTIFF specification while enabling support for multidimensional arrays. The table below highlights the mandatory and optional fields within the <code>MD_METADATA</code> JSON structure:</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Details</th></tr></thead><tbody><tr><td>md:pattern</td><td>string</td><td>Yes</td><td>A string defining the strategy to reshape the data into a 3D array (band, x, y). It is based on the Einstein-Inspired Notation for OPerationS, einops. The pattern is a space-separated list of dimension names, followed by an arrow <code>-&gt;</code>, and the new order of the dimensions. For example, <code>time band y x -&gt; (time band) y x</code> rearranges the dimensions from <code>(time, band, y, x)</code> to <code>time×band y x</code>, where <code>time×band</code> is a new number of channels. As GeoTIFF define explicitly the <code>y</code> and <code>x</code> dimensions, the pattern <strong>MUST</strong> always include them. There is no restriction on the number of dimensions. Refer to the <a href="https://openreview.net/pdf?id=oapKSVM2bcj" target="_blank" rel="noreferrer">einops paper</a> for more details about the notation.</td></tr><tr><td>md:coordinates</td><td>dictionary</td><td>Yes</td><td>A dictionary defining the coordinates to be combined with the pattern. The values <strong>MUST</strong> be lists of data types compliant with the <a href="https://www.json.org/json-en.html" target="_blank" rel="noreferrer">JSON standard</a>.</td></tr><tr><td>md:attributes</td><td>dictionary</td><td>No</td><td>A dictionary of additional metadata attributes to include in the file. It <strong>MUST</strong> comply with the <a href="https://www.json.org/json-en.html" target="_blank" rel="noreferrer">JSON standard</a>.</td></tr><tr><td>md:dimensions</td><td>list</td><td>No</td><td>A list of dimension names, where the order <strong>MUST</strong> align with the order specified in <code>md:pattern</code> before the arrow <code>-&gt;</code>. If not provided, it is automatically generated based on the <code>md:pattern</code> key.</td></tr><tr><td>md:coordinates_len</td><td>dictionary</td><td>No</td><td>A dictionary defining the length of each dimension. The values <strong>MUST</strong> be integers. If omitted, it is automatically determined from the <code>md:coordinates</code> key.</td></tr></tbody></table><p>It is created automatically when it is not provided.</p><h2 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h2><p>The following is an example of the <code>MD_METADATA</code> tag in a mGeoTIFF file:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;md:pattern&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;time band y x -&gt; (time band) y x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;md:coordinates&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2021-01-01&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2021-01-02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2021-01-03&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;band&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;B01&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;B02&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;B03&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;md:dimensions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;band&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;y&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;md:attributes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Multidimensional GeoTIFF Example&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;This is a toy example of a Multidimensional GeoTIFF file.&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;md:coordinates_len&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;band&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;lat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;lon&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="understanding-i-o-operations" tabindex="-1">Understanding I/O Operations <a class="header-anchor" href="#understanding-i-o-operations" aria-label="Permalink to &quot;Understanding I/O Operations&quot;">​</a></h2><h3 id="writing-data" tabindex="-1">Writing Data <a class="header-anchor" href="#writing-data" aria-label="Permalink to &quot;Writing Data&quot;">​</a></h3><p>To simplify the explanation of how the I/O works, we will reference the Python API of <a href="https://github.com/tacofoundation/mrio" target="_blank" rel="noreferrer">mrio</a>. When writing a mGeoTIFF file, users must define the <code>MD_METADATA</code> tag as a dictionary. This dictionary is validated using Python dataclass fields (<a href="https://github.com/tacofoundation/mrio-python/blob/main/mrio/fields.py" target="_blank" rel="noreferrer">validation details</a>) and then converted to a JSON string. Refer to the mrio <a href="https://https://tacofoundation.github.io/mrio/en/python/examples.html" target="_blank" rel="noreferrer">Python examples</a> for guidance on writing an mGeoTIFF file.</p><figure style="display:flex;flex-direction:column;align-items:center;"><img src="`+l+`" alt="Band GIF" style="width:70%;"><figcaption style="text-align:center;"><b>Figure 1:</b> Writing an nD Array to a GDALGeoTIFF Using mrio.</figcaption></figure><p>By default, all <code>mrio</code> files are created as COGs without overviews. The default creation options are as follows:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">creation_options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;COMPRESS=DEFLATE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;BLOCKSIZE=128&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;INTERLEAVE=TILE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;BIGTIFF=YES&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;OVERVIEWS=NONE&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>Arrays of arbitrary dimensions are reshaped into a 3D array (band, y, x) using the <code>md:pattern</code> field. With the <code>INTERLEAVE=TILE</code> option (check our post about <a href="https://https://tacofoundation.github.io/mrio/en/specification/cog.html#file-requirements" target="_blank" rel="noreferrer">COGs</a>), data is compressed into <code>1 × BLOCKSIZE × BLOCKSIZE</code> tiles and arranged contiguously along the band dimension.</p><p>In a 4-D array, the <code>md:pattern</code> can be defined in two ways.</p><ul><li><p>In the case <code>time band y x -&gt; (time band) y x</code>, data is stored continuously by band within each time step, such as: <code>b1time1, b2time1, ..., b1time2, b2time2, ..., b1time3, b2time3, ....</code></p></li><li><p>In the case <code>time band y x -&gt; (band time) y x</code>, data is stored continuously by time within each band, such as: <code>b1time1, b1time2, ..., b2time1, b2time2, ..., b3time1, b3time2, ....</code></p></li></ul><p>Data providers with large time dimensions (e.g., daily satellite imagery spanning decades) might prefer the band-time interleave layout. This approach ensures temporal byte continuity within the file, enabling efficient retrieval of time-series data. Specifically, requests for any length of time-series data can be fulfilled with just <strong>a single HTTP range request</strong>.</p><figure><img src="`+d+`" alt="GeoTIFF file structure" style="width:100%;"><figcaption style="text-align:center;"><b>Figure 2:</b>Visual comparison of the effects of different \`md:pattern\` strategies.</figcaption></figure><p>By default, <code>mrio</code> assigns band descriptions (also known as band names) following the GDAL GeoTIFF convention. These descriptions are stored in the <code>TIFFTAG_GDAL_METADATA</code> XML tag. The band descriptions set names based on the <code>md:coordinates</code> key-value pairs. For example, given a Sentinel-2 5D array with the <code>md:pattern</code> of <code>product time band y x -&gt; (band product time) y x</code>, the resulting band descriptions will be:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>band[0]__product[0]__time[0] # B01__boa__20210101</span></span>
<span class="line"><span>band[0]__product[0]__time[1] # B01__boa__20210106</span></span>
<span class="line"><span>band[0]__product[0]__time[2] # B01__boa__20210111</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>band[0]__product[1]__time[0] # B01__toa__20210101</span></span>
<span class="line"><span>band[0]__product[1]__time[1] # B01__toa__20210106</span></span>
<span class="line"><span>band[0]__product[1]__time[2] # B01__toa__20210111</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>band[1]__product[0]__time[0] # B02__boa__20210101</span></span>
<span class="line"><span>band[1]__product[0]__time[1] # B02__boa__20210106</span></span>
<span class="line"><span>band[1]__product[0]__time[2] # B02__boa__20210111</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>band[1]__product[1]__time[0] # B02__toa__20210101</span></span>
<span class="line"><span>band[1]__product[1]__time[1] # B02__toa__20210106</span></span>
<span class="line"><span>band[1]__product[1]__time[2] # B02__toa__20210111</span></span></code></pre></div><p>Here, <code>band[x]</code>, <code>product[y]</code>, and <code>time[z]</code> correspond to the names specified in the <code>md:coordinates</code> dictionary. The <code>__</code> separator is used to distinguish between dimensions. When dragging and dropping mCOG files into GIS software, the band descriptions will be displayed as the band names.</p><figure><img src="`+h+'" alt="GeoTIFF file structure" style="width:100%;"><figcaption style="text-align:center;"><b>Figure 3: </b>Example of a mCOG displayed in QGIS</figcaption></figure><h3 id="reading-data" tabindex="-1">Reading Data <a class="header-anchor" href="#reading-data" aria-label="Permalink to &quot;Reading Data&quot;">​</a></h3><p>When reading a mGeoTIFF file, the <code>mrio</code> API reconstructs the original multidimensional array and metadata by reversing the transformations applied during the writing process.</p><figure style="display:flex;flex-direction:column;align-items:center;"><img src="'+p+'" style="width:70%;"><figcaption style="text-align:center;"><b>Figure 4: </b>Reading a GDAL GeoTIFF into an nD Array Using mrio.</figcaption></figure><p>The reconstruction involves the following steps:</p><ol><li><p><strong>Opening the File</strong>: The file is opened using the GDAL utility, and the <code>TIFFTAG_GDAL_METADATA</code> tag is accessed to retrieve the <code>MD_METADATA</code> JSON string.</p></li><li><p><strong>Parsing Metadata</strong>: The <code>MD_METADATA</code> string is parsed into a Python dictionary. Key fields, such as <code>md:pattern</code> and <code>md:coordinates</code>, are used to determine how the array should be reshaped to restore its original dimensions. Partial reads are supported, by <a href="https://github.com/tacofoundation/mrio-python/blob/708ce05b5cebbf38c2114399ed54c5b4b5769443/mrio/chunk_reader.py#L69" target="_blank" rel="noreferrer">vectorized operations</a>.</p></li><li><p><strong>Creating the Output</strong>: When the <code>engine</code> parameter is set to <code>xarray</code> (the default), the <code>md:attributes</code> field is also extracted. This enables the API to construct an <code>xarray.DataArray</code> object with the associated attributes and coordinates. Numpy is supported too.</p></li></ol><h2 id="faq" tabindex="-1">FAQ <a class="header-anchor" href="#faq" aria-label="Permalink to &quot;FAQ&quot;">​</a></h2>',36),e("details",{class:"details custom-block",close:""},[e("summary",null,"Is it supported by QGIS?"),e("p",null,[t("If you open a mGeoTIFF file in QGIS, QGIS will display a "),e("code",null,"special"),t(" band names that are generated by "),e("code",null,"mrio"),t(".")])],-1),e("details",{class:"details custom-block",close:""},[e("summary",null,"Is it supported by GDAL?"),e("p",null,"Not natively. However, as mCOG is a COG file, it can be read by GDAL. That is actually what Python API does. It uses GDAL to read the file and then it virtually reshapes the data to the original shape.")],-1),e("details",{class:"details custom-block",close:""},[e("summary",null,"Which programming languages are supported?"),e("p",null,[t("The "),e("code",null,"mrio"),t(" API is currently available in Python. However, we have plans to support R and Julia in the future.")])],-1),e("details",{class:"details custom-block",close:""},[e("summary",null,"Can I use it with TensorFlow or PyTorch?"),e("p",null,[t("Yes, you can! In fact, we developed "),e("code",null,"mrio"),t(" specifically for use in our internal deep-learning pipes at "),e("a",{href:"https://isp.uv.es/",target:"_blank",rel:"noreferrer"},"ISP - Image and Signal Processing group"),t(".")])],-1),a('<h2 id="why-not-use-netcdf-hdf5-or-zarr" tabindex="-1">Why not use NetCDF, HDF5, or Zarr? <a class="header-anchor" href="#why-not-use-netcdf-hdf5-or-zarr" aria-label="Permalink to &quot;Why not use NetCDF, HDF5, or Zarr?&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><strong>A Personal Perspective:</strong> This reflects our views, Cesar Aybar and Julio Contreras. Many colleagues (including close friends!) actively advocate for <a href="https://www.youtube.com/watch?v=m345_TUjIdI" target="_blank" rel="noreferrer">NetCDF</a>. We all think Zarr is great, but it is not ready yet!</p></div><p><em>“Explicit is better than implicit.”</em> (<a href="https://peps.python.org/pep-0020/" target="_blank" rel="noreferrer">The Zen of Python</a>)</p><p>While there are many existing byte containers for multidimensional arrays, such as NetCDF, HDF5, and Zarr, our decision to use GeoTIFF stems from a combination of practical and community-based considerations:</p><ol><li><p><strong>Leverage Existing Tools and Expertise</strong>: There are many byte container formats available online. In theory, one could design a multidimensional array format using TIFF by saving each n-dimensional chunk in a separate IFD. With some effort, this approach could potentially achieve efficiency comparable to other n-dimensional array formats. However, by choosing the COG layout <strong>all the necessary tools already exist</strong>. GDAL is highly optimized for working with COG files and is supported by a large, active community of experts continuously improving and maintaining it. Back to the example of an illusional n-D chunked TIFF format, it would not only require significant effort to develop but also writing a lot of code to ensure compatibility with other software (i.e. QGIS). In practice, the success of a format often depends more on the people supporting it than if a format is theoretically better than another.</p></li><li><p><strong>Stability and Maturity</strong>: GeoTIFF, in particular, has benefited from decades of development and refinement, making it a mature and highly stable format. This stability and maturity are key factors in its widespread adoption and reliability. One could argue that HDF5 is also &quot;stable&quot;. However, the key difference lies in its scope, HDF5 is an extremely ambitious project compared to GeoTIFF or Zarr. Maintaining its large number of features and extensions is a complex task. Check the <a href="https://support.hdfgroup.org/documentation/hdf5/latest/_f_m_t3.html" target="_blank" rel="noreferrer">HDF5 specification</a> to give you an idea of the complexity. Breaking changes between minor versions is very common, which can disrupt compatibility for software built on top of it, such as NetCDF. This complexity makes HDF5 less interoperable, specifically for less experienced users.</p></li><li><p><strong>Zarr&#39;s Promising Yet Nascent Approach</strong>:</p></li></ol><p>Zarr is another general-purpose format, it is relatively new and highly flexible, with a clear specification with fewer than 10 pages. In Zarr, almost everything except for the datatype, compression, shape, and chunk size is implicit. Instead of being a fully self-contained file format, Zarr operates more as a convention for organizing n-dimensional arrays in a folder structure. Zarr is cool but it can be very challenging to implement in an efficiency manner. Consider the case of a single Sentinel-2 scene 13x10980x10980 pixels (<code>CHUNKSIZE=128;INTERLEAVE=TILE</code>), all the data with overviews included can be just one COG file. In Zarr, considering the same chunk size, it will be 24037 different files (we are not considering the overviews!). This is extremely inefficient and very costly in cloud storage. In a HTTP/2 context, GET operations that will cost 1 HTTP request in a COG, will cost hundreds/thousands in Zarr. However, with the introduction of sharding (<a href="https://zarr.dev/zeps/accepted/ZEP0002.html" target="_blank" rel="noreferrer">ZEP 2</a>), which enables chunk parsing, Zarr can partially solve this problem. Actually the Python <a href="https://github.com/zarr-developers/zarr-python" target="_blank" rel="noreferrer">Zarr API</a><br> and the other non-official Python <a href="https://github.com/ilan-gold/zarrs-python" target="_blank" rel="noreferrer">Zarr API</a> already support this feature. There are some geospatial initiatives like <a href="https://github.com/zarr-developers/geozarr-spec" target="_blank" rel="noreferrer">GeoZarr</a> but, they are very incipient.</p><p>As you can see, there is no perfect format for n-dimensional data. With mGeoTIFF, we aim to provide a simple, stable, and explicit format for n-dimensional arrays. By building on top of the COG layout. However, there are some drawbacks to this approach that data providers should be aware of:</p><ol><li><p><strong>Hard to apply streaming operations</strong>, especially when user-defined overviews are involved. While not technically impossible, implementing streaming in mCOG is more complex compared to Zarr&#39;s chunked design, where this process is quite more straightforward.</p></li><li><p><strong>Limited support for complex nested data structures</strong>. It is not supported to store complex nested data structures in mCOG, like a list of n-dimensional arrays.</p></li><li><p><strong>Imposible to extend the chunking schema</strong>. In mGeoTIFF, the chunking schema is dimension fixed. This means that if you have a 4D array, you can only define the chunking schema as (1 x 1 x BLOCKXSIZE x BLOCKYSIZE) or (1 x C x BLOCKXSIZE x BLOCKYSIZE) if pixel interleave is used. Chunking schema is a natural feature in Zarr or NetCDF5. This limitation is critical because it will make it larger in size with respect to Zarr or NetCDF5, especially when there is a lot of redundancy in the data (e.g. climate data).</p></li></ol><p>Despite these limitations, we believe that multidimensional GeoTIFF is currently the best option for many use cases. Whether you are creating a web map to visualize 10 years of changes in your village or building a deep learning dataset with multitemporal samples, mCOG provides a robust, mature, and reliable solution.</p>',9)]))}const _=s(c,[["render",m]]);export{E as __pageData,_ as default};
